<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outfit Mixer - Fashion X</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            min-height: 100vh;
            color: #1a1a1a;
        }

        .header {
            background: #fff;
            padding: 20px 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-bottom: 1px solid #e0e0e0;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 300;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .container {
            display: flex;
            max-width: 1400px;
            margin: 40px auto;
            gap: 40px;
            padding: 0 20px;
        }

        .left-column {
            flex: 1;
            background: #fff;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            position: relative;
            min-height: 600px;
        }

        .instructions {
            line-height: 1.8;
            color: #666;
        }

        .instructions h2 {
            font-size: 22px;
            font-weight: 400;
            margin-bottom: 20px;
            color: #1a1a1a;
        }

        .instructions ul {
            list-style: none;
            padding-left: 0;
        }

        .instructions li {
            margin-bottom: 15px;
            padding-left: 25px;
            position: relative;
        }

        .instructions li:before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: #666;
        }

        .selection-table {
            display: none;
        }

        .selection-table h2 {
            font-size: 22px;
            font-weight: 400;
            margin-bottom: 25px;
            color: #1a1a1a;
        }

        .selected-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #fafafa;
            border-radius: 8px;
            margin-bottom: 12px;
            border: 1px solid #e0e0e0;
            transition: all 0.3s ease;
        }

        .selected-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .item-thumbnail {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
            margin-right: 15px;
        }

        .item-details {
            flex: 1;
        }

        .item-category {
            font-size: 11px;
            text-transform: uppercase;
            color: #999;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }

        .item-name {
            font-size: 14px;
            font-weight: 500;
            color: #1a1a1a;
        }

        .item-brand {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .remove-item {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 20px;
            padding: 5px 10px;
            transition: color 0.3s;
        }

        .remove-item:hover {
            color: #ff4444;
        }

        .preview-button {
            width: 100%;
            padding: 15px;
            background: #1a1a1a;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 1px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .preview-button:hover {
            background: #000;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .preview-panel {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #fff;
            border-radius: 12px;
            padding: 30px;
            animation: flipIn 0.6s ease;
        }

        @keyframes flipIn {
            from {
                transform: rotateY(-90deg);
                opacity: 0;
            }
            to {
                transform: rotateY(0);
                opacity: 1;
            }
        }

        .preview-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 30px;
        }

        .preview-item {
            text-align: center;
        }

        .preview-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .preview-item-label {
            font-size: 12px;
            text-transform: uppercase;
            color: #666;
            letter-spacing: 1px;
        }

        .close-preview {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            transition: color 0.3s;
        }

        .close-preview:hover {
            color: #1a1a1a;
        }

        .center-column {
            flex: 1.5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .wheel-container {
            position: relative;
            width: 500px;
            height: 500px;
        }

        .wheel-svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.1));
        }

        .wheel-slice {
            cursor: pointer;
            transition: all 0.3s ease;
            transform-origin: center;
        }

        .wheel-slice:hover {
            transform: scale(1.05);
            filter: brightness(1.1);
        }

        .wheel-slice.selected {
            filter: brightness(1.2);
            transform: scale(1.05);
        }

        .slice-label {
            pointer-events: none;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            fill: #fff;
        }

        .slice-image {
            pointer-events: none;
            clip-path: url(#sliceClip);
        }

        .mix-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1a1a1a 0%, #333 100%);
            color: #fff;
            border: 3px solid #fff;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 10;
        }

        .mix-button:hover {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow: 0 6px 30px rgba(0,0,0,0.4);
        }

        .mix-button.spinning {
            animation: spin 2s ease-in-out;
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(720deg); }
        }

        .right-column {
            flex: 0.8;
            background: #fff;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .filters-title {
            font-size: 18px;
            font-weight: 400;
            margin-bottom: 25px;
            color: #1a1a1a;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .filter-group {
            margin-bottom: 25px;
        }

        .filter-label {
            font-size: 13px;
            font-weight: 500;
            color: #666;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .toggle-group {
            display: flex;
            gap: 12px;
        }

        .toggle-button {
            flex: 1;
            padding: 10px;
            background: #f5f5f5;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: capitalize;
        }

        .toggle-button.active {
            background: #1a1a1a;
            color: #fff;
            border-color: #1a1a1a;
        }

        .toggle-button:hover:not(.active) {
            background: #e8e8e8;
        }

        .category-toggles {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .category-toggle {
            padding: 8px 12px;
            background: #f5f5f5;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: capitalize;
        }

        .category-toggle.active {
            background: #1a1a1a;
            color: #fff;
            border-color: #1a1a1a;
        }

        .product-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            border-radius: 12px;
            padding: 30px;
            width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translate(-50%, -40%);
                opacity: 0;
            }
            to {
                transform: translate(-50%, -50%);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 400;
            text-transform: capitalize;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: #1a1a1a;
        }

        .search-box {
            width: 100%;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .search-box:focus {
            outline: none;
            border-color: #1a1a1a;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .product-card {
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e0e0e0;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .product-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .product-info {
            padding: 12px;
            background: #fff;
        }

        .product-name {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 4px;
            color: #1a1a1a;
        }

        .product-brand {
            font-size: 11px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Fashion X - Outfit Mixer</h1>
    </div>

    <div class="container">
        <div class="left-column">
            <div class="instructions" id="instructions">
                <h2>How to Mix Your Perfect Outfit</h2>
                <ul>
                    <li>Click on any slice of the wheel to select items from that category</li>
                    <li>Choose your favorite pieces from the popup catalog</li>
                    <li>Build your outfit piece by piece, or let our AI mix it for you</li>
                    <li>Click the MIX button to get AI-powered recommendations</li>
                    <li>Preview your complete outfit when you're done</li>
                </ul>
            </div>

            <div class="selection-table" id="selectionTable">
                <h2>Your Outfit Selection</h2>
                <div id="selectedItems"></div>
                <button class="preview-button" onclick="showPreview()">Preview Outfit</button>
            </div>

            <div class="preview-panel" id="previewPanel">
                <button class="close-preview" onclick="closePreview()">Ã—</button>
                <h2>Your Complete Outfit</h2>
                <div class="preview-grid" id="previewGrid"></div>
            </div>
        </div>

        <div class="center-column">
            <div class="wheel-container">
                <svg class="wheel-svg" viewBox="0 0 500 500" id="wheelSvg">
                    <defs>
                        <clipPath id="sliceClip">
                            <path d="M 250 250 L 250 50 A 200 200 0 0 1 250 50 Z" />
                        </clipPath>
                    </defs>
                </svg>
                <button class="mix-button" id="mixButton" onclick="mixOutfit()">Mix</button>
            </div>
        </div>

        <div class="right-column">
            <h3 class="filters-title">Outfit Preferences</h3>
            
            <div class="filter-group">
                <div class="filter-label">Gender</div>
                <div class="toggle-group">
                    <button class="toggle-button active">All</button>
                    <button class="toggle-button">Women</button>
                    <button class="toggle-button">Men</button>
                    <button class="toggle-button">Unisex</button>
                </div>
            </div>

            <div class="filter-group">
                <div class="filter-label">Season</div>
                <div class="toggle-group">
                    <button class="toggle-button active">All</button>
                    <button class="toggle-button">Spring</button>
                    <button class="toggle-button">Summer</button>
                    <button class="toggle-button">Fall</button>
                    <button class="toggle-button">Winter</button>
                </div>
            </div>

            <div class="filter-group">
                <div class="filter-label">Style</div>
                <div class="toggle-group">
                    <button class="toggle-button active">All</button>
                    <button class="toggle-button">Casual</button>
                    <button class="toggle-button">Formal</button>
                    <button class="toggle-button">Business</button>
                </div>
            </div>

            <div class="filter-group">
                <div class="filter-label">Categories</div>
                <div class="category-toggles" id="categoryToggles"></div>
            </div>
        </div>
    </div>

    <div class="product-modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Select Item</h2>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <input type="text" class="search-box" id="searchBox" placeholder="Search products...">
            <div class="product-grid" id="productGrid"></div>
        </div>
    </div>

    <script>
        let productCatalog = {
            "belts": [
                {"name": "Classic Leather Belt", "brand": "Brand A", "image_path": "images/belts/belt1.jpg"},
                {"name": "Woven Canvas Belt", "brand": "Brand B", "image_path": "images/belts/belt2.jpg"},
                {"name": "Reversible Belt", "brand": "Brand C", "image_path": "images/belts/belt3.jpg"},
                {"name": "Chain Link Belt", "brand": "Brand D", "image_path": "images/belts/belt4.jpg"},
                {"name": "Braided Leather Belt", "brand": "Brand E", "image_path": "images/belts/belt5.jpg"},
                {"name": "Designer Buckle Belt", "brand": "Brand F", "image_path": "images/belts/belt6.jpg"}
            ],
            "bottoms": [
                {"name": "Floral Midi Dress", "brand": "Brand G", "image_path": "images/bottoms/dress1.jpg"},
                {"name": "Wrap Dress", "brand": "Brand H", "image_path": "images/bottoms/dress2.jpg"},
                {"name": "Cocktail Dress", "brand": "Brand A", "image_path": "images/bottoms/dress3.jpg"},
                {"name": "Slim Fit Jeans", "brand": "Brand B", "image_path": "images/bottoms/jeans1.jpg"},
                {"name": "High-Waisted Jeans", "brand": "Brand C", "image_path": "images/bottoms/jeans2.jpg"},
                {"name": "Distressed Denim", "brand": "Brand D", "image_path": "images/bottoms/jeans3.jpg"},
                {"name": "Wide Leg Jeans", "brand": "Brand E", "image_path": "images/bottoms/jeans4.jpg"},
                {"name": "Pleated Midi Skirt", "brand": "Brand F", "image_path": "images/bottoms/skirt1.jpg"},
                {"name": "A-Line Skirt", "brand": "Brand G", "image_path": "images/bottoms/skirt2.jpg"},
                {"name": "Pencil Skirt", "brand": "Brand H", "image_path": "images/bottoms/skirt3.jpg"}
            ],
            "earrings": [
                {"name": "Pearl Drop Earrings", "brand": "Brand A", "image_path": "images/earrings/earrings1.jpg"},
                {"name": "Gold Hoop Earrings", "brand": "Brand B", "image_path": "images/earrings/earrings2.jpg"},
                {"name": "Crystal Stud Earrings", "brand": "Brand C", "image_path": "images/earrings/earrings3.jpg"},
                {"name": "Chandelier Earrings", "brand": "Brand D", "image_path": "images/earrings/earrings4.jpg"},
                {"name": "Minimalist Bar Earrings", "brand": "Brand E", "image_path": "images/earrings/earrings5.jpg"}
            ],
            "gloves": [
                {"name": "Leather Driving Gloves", "brand": "Brand F", "image_path": "images/gloves/gloves1.jpg"},
                {"name": "Cashmere Gloves", "brand": "Brand G", "image_path": "images/gloves/gloves2.jpg"},
                {"name": "Fingerless Gloves", "brand": "Brand H", "image_path": "images/gloves/gloves3.jpg"},
                {"name": "Winter Wool Gloves", "brand": "Brand A", "image_path": "images/gloves/gloves4.jpg"},
                {"name": "Evening Opera Gloves", "brand": "Brand B", "image_path": "images/gloves/gloves5.jpg"},
                {"name": "Touchscreen Gloves", "brand": "Brand C", "image_path": "images/gloves/gloves6.jpg"}
            ],
            "handbags": [
                {"name": "Tote Bag", "brand": "Brand D", "image_path": "images/handbags/handbag1.jpg"},
                {"name": "Crossbody Bag", "brand": "Brand E", "image_path": "images/handbags/handbag2.jpg"},
                {"name": "Clutch Purse", "brand": "Brand F", "image_path": "images/handbags/handbag3.jpg"},
                {"name": "Shoulder Bag", "brand": "Brand G", "image_path": "images/handbags/handbag4.jpg"},
                {"name": "Bucket Bag", "brand": "Brand H", "image_path": "images/handbags/handbag5.jpg"},
                {"name": "Satchel Bag", "brand": "Brand A", "image_path": "images/handbags/handbag6.jpg"},
                {"name": "Hobo Bag", "brand": "Brand B", "image_path": "images/handbags/handbag7.jpg"}
            ],
            "hats": [
                {"name": "Fedora Hat", "brand": "Brand C", "image_path": "images/hats/hat1.jpg"},
                {"name": "Baseball Cap", "brand": "Brand D", "image_path": "images/hats/hat2.jpg"},
                {"name": "Wide Brim Sun Hat", "brand": "Brand E", "image_path": "images/hats/hat3.jpg"},
                {"name": "Beanie", "brand": "Brand F", "image_path": "images/hats/hat4.jpg"},
                {"name": "Beret", "brand": "Brand G", "image_path": "images/hats/hat5.jpg"}
            ],
            "necklaces": [
                {"name": "Pearl Strand Necklace", "brand": "Brand H", "image_path": "images/necklaces/necklace1.jpg"},
                {"name": "Gold Chain Necklace", "brand": "Brand A", "image_path": "images/necklaces/necklace2.jpg"},
                {"name": "Pendant Necklace", "brand": "Brand B", "image_path": "images/necklaces/necklace3.jpg"},
                {"name": "Choker Necklace", "brand": "Brand C", "image_path": "images/necklaces/necklace4.jpg"}
            ],
            "scaves": [
                {"name": "Silk Scarf", "brand": "Brand D", "image_path": "images/scaves/scarf1.jpg"},
                {"name": "Cashmere Scarf", "brand": "Brand E", "image_path": "images/scaves/scarf2.jpg"},
                {"name": "Infinity Scarf", "brand": "Brand F", "image_path": "images/scaves/scarf3.jpg"},
                {"name": "Printed Square Scarf", "brand": "Brand G", "image_path": "images/scaves/scarf4.jpg"},
                {"name": "Wool Blanket Scarf", "brand": "Brand H", "image_path": "images/scaves/scarf5.jpg"},
                {"name": "Lightweight Summer Scarf", "brand": "Brand A", "image_path": "images/scaves/scarf6.jpg"},
                {"name": "Fringed Wrap Scarf", "brand": "Brand B", "image_path": "images/scaves/scarf7.jpg"}
            ],
            "shoes": [
                {"name": "Leather Oxford Shoes", "brand": "Brand C", "image_path": "images/shoes/shoes1.jpg"},
                {"name": "High-Top Sneakers", "brand": "Brand D", "image_path": "images/shoes/shoes2.jpg"},
                {"name": "Ankle Boots", "brand": "Brand E", "image_path": "images/shoes/shoes3.jpg"},
                {"name": "Running Shoes", "brand": "Brand F", "image_path": "images/shoes/shoes4.jpg"}
            ],
            "sunglasses": [
                {"name": "Aviator Sunglasses", "brand": "Brand G", "image_path": "images/sunglasses/sunglassess1.jpg"},
                {"name": "Cat Eye Sunglasses", "brand": "Brand H", "image_path": "images/sunglasses/sunglassess2.jpg"},
                {"name": "Round Frame Sunglasses", "brand": "Brand A", "image_path": "images/sunglasses/sunglassess3.jpg"},
                {"name": "Wayfarer Sunglasses", "brand": "Brand B", "image_path": "images/sunglasses/sunglassess4.jpg"},
                {"name": "Sport Sunglasses", "brand": "Brand C", "image_path": "images/sunglasses/sunglassess5.jpg"}
            ],
            "tops": [
                {"name": "Wool Overcoat", "brand": "Brand D", "image_path": "images/tops/coat1.jpg"},
                {"name": "Trench Coat", "brand": "Brand E", "image_path": "images/tops/coat2.jpg"},
                {"name": "Puffer Coat", "brand": "Brand F", "image_path": "images/tops/coat3.jpg"},
                {"name": "Maxi Dress", "brand": "Brand G", "image_path": "images/tops/dress1.png"},
                {"name": "Shift Dress", "brand": "Brand H", "image_path": "images/tops/dress2.png"},
                {"name": "Evening Gown", "brand": "Brand A", "image_path": "images/tops/dress7.jpg"},
                {"name": "Denim Jacket", "brand": "Brand B", "image_path": "images/tops/jacket1.jpg"},
                {"name": "Leather Jacket", "brand": "Brand C", "image_path": "images/tops/jacket2.jpg"},
                {"name": "Bomber Jacket", "brand": "Brand D", "image_path": "images/tops/jacket3.jpg"},
                {"name": "Cotton T-Shirt", "brand": "Brand E", "image_path": "images/tops/top1.png"},
                {"name": "Silk Blouse", "brand": "Brand F", "image_path": "images/tops/top2.png"},
                {"name": "Knit Sweater", "brand": "Brand G", "image_path": "images/tops/top3.png"},
                {"name": "Linen Shirt", "brand": "Brand H", "image_path": "images/tops/top4.png"}
            ],
            "watches": [
                {"name": "Classic Analog Watch", "brand": "Brand A", "image_path": "images/watches/watch1.jpg"},
                {"name": "Digital Sport Watch", "brand": "Brand B", "image_path": "images/watches/watch2.jpg"},
                {"name": "Chronograph Watch", "brand": "Brand C", "image_path": "images/watches/watch3.jpg"},
                {"name": "Smart Watch", "brand": "Brand D", "image_path": "images/watches/watch4.jpg"},
                {"name": "Dress Watch", "brand": "Brand E", "image_path": "images/watches/watch5.jpg"},
                {"name": "Dive Watch", "brand": "Brand F", "image_path": "images/watches/watch6.jpg"}
            ]
        };
        let selectedItems = {};
        let currentCategory = null;
        const categories = ['belts', 'bottoms', 'earrings', 'gloves', 'handbags', 'hats', 'necklaces', 'scaves', 'shoes', 'sunglasses', 'tops', 'watches'];
        
        const categoryColors = {
            'tops': '#2C3E50',
            'bottoms': '#34495E',
            'shoes': '#7F8C8D',
            'hats': '#95A5A6',
            'sunglasses': '#BDC3C7',
            'watches': '#ECF0F1',
            'belts': '#D5DBDB',
            'handbags': '#ABB2B9',
            'earrings': '#808B96',
            'necklaces': '#566573',
            'scaves': '#2C3E50',
            'gloves': '#273746'
        };

        function loadProductCatalog() {
            console.log('Using embedded catalog with categories:', Object.keys(productCatalog));
            initializeWheel();
            initializeCategoryToggles();
        }

        function initializeWheel() {
            const svg = document.getElementById('wheelSvg');
            svg.innerHTML = ''; // Clear existing content
            
            const centerX = 250;
            const centerY = 250;
            const radius = 180;
            const innerRadius = 80;
            
            const anglePerSlice = 360 / categories.length;
            
            categories.forEach((category, index) => {
                const startAngle = index * anglePerSlice;
                const endAngle = (index + 1) * anglePerSlice;
                
                const startAngleRad = (startAngle * Math.PI) / 180;
                const endAngleRad = (endAngle * Math.PI) / 180;
                
                // Outer arc points
                const x1 = centerX + radius * Math.cos(startAngleRad);
                const y1 = centerY + radius * Math.sin(startAngleRad);
                const x2 = centerX + radius * Math.cos(endAngleRad);
                const y2 = centerY + radius * Math.sin(endAngleRad);
                
                // Inner arc points
                const x3 = centerX + innerRadius * Math.cos(startAngleRad);
                const y3 = centerY + innerRadius * Math.sin(startAngleRad);
                const x4 = centerX + innerRadius * Math.cos(endAngleRad);
                const y4 = centerY + innerRadius * Math.sin(endAngleRad);
                
                const largeArcFlag = anglePerSlice > 180 ? 1 : 0;
                
                const pathData = [
                    `M ${x3} ${y3}`,
                    `L ${x1} ${y1}`,
                    `A ${radius} ${radius} 0 ${largeArcFlag} 1 ${x2} ${y2}`,
                    `L ${x4} ${y4}`,
                    `A ${innerRadius} ${innerRadius} 0 ${largeArcFlag} 0 ${x3} ${y3}`,
                    'Z'
                ].join(' ');
                
                const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                g.classList.add('wheel-slice');
                g.dataset.category = category;
                g.onclick = () => openProductModal(category);
                
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathData);
                path.setAttribute('fill', categoryColors[category] || `hsl(${index * 30}, 70%, 60%)`);
                path.setAttribute('stroke', '#fff');
                path.setAttribute('stroke-width', '3');
                
                // Add text label
                const midAngle = (startAngle + endAngle) / 2;
                const midAngleRad = (midAngle * Math.PI) / 180;
                const labelRadius = (radius + innerRadius) / 2;
                const labelX = centerX + labelRadius * Math.cos(midAngleRad);
                const labelY = centerY + labelRadius * Math.sin(midAngleRad) + 5;
                
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', labelX);
                text.setAttribute('y', labelY);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('dominant-baseline', 'middle');
                text.classList.add('slice-label');
                text.textContent = category.charAt(0).toUpperCase() + category.slice(1);
                
                g.appendChild(path);
                g.appendChild(text);
                
                svg.appendChild(g);
            });
            
            console.log('Wheel initialized with', categories.length, 'slices');
        }

        function addImageToSlice(sliceGroup, category, item) {
            const existingImage = sliceGroup.querySelector('.slice-image');
            if (existingImage) {
                existingImage.remove();
            }
            
            const centerX = 250;
            const centerY = 250;
            const imageRadius = 140;
            const index = categories.indexOf(category);
            const anglePerSlice = 360 / categories.length;
            const midAngle = (index * anglePerSlice + (index + 1) * anglePerSlice) / 2 - 90;
            const midAngleRad = (midAngle * Math.PI) / 180;
            
            const imageX = centerX + imageRadius * Math.cos(midAngleRad) - 20;
            const imageY = centerY + imageRadius * Math.sin(midAngleRad) - 20;
            
            const image = document.createElementNS('http://www.w3.org/2000/svg', 'image');
            image.setAttribute('href', item.image_path);
            image.setAttribute('x', imageX);
            image.setAttribute('y', imageY);
            image.setAttribute('width', '40');
            image.setAttribute('height', '40');
            image.classList.add('slice-image');
            image.style.borderRadius = '50%';
            image.style.pointerEvents = 'none';
            
            sliceGroup.appendChild(image);
        }

        function initializeCategoryToggles() {
            const container = document.getElementById('categoryToggles');
            categories.forEach(category => {
                const toggle = document.createElement('button');
                toggle.className = 'category-toggle active';
                toggle.textContent = category;
                toggle.onclick = () => {
                    toggle.classList.toggle('active');
                };
                container.appendChild(toggle);
            });
        }

        function openProductModal(category) {
            currentCategory = category;
            const modal = document.getElementById('productModal');
            const modalTitle = document.getElementById('modalTitle');
            const productGrid = document.getElementById('productGrid');
            const searchBox = document.getElementById('searchBox');
            
            modalTitle.textContent = `Select ${category}`;
            searchBox.value = '';
            
            displayProducts(category);
            modal.style.display = 'block';
        }

        function displayProducts(category, searchTerm = '') {
            const productGrid = document.getElementById('productGrid');
            productGrid.innerHTML = '';
            
            const products = productCatalog[category] || [];
            const filteredProducts = products.filter(product => 
                product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                product.brand.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            filteredProducts.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.onclick = () => selectProduct(category, product);
                
                card.innerHTML = `
                    <img src="${product.image_path}" alt="${product.name}" class="product-image">
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-brand">${product.brand}</div>
                    </div>
                `;
                
                productGrid.appendChild(card);
            });
        }

        function selectProduct(category, product) {
            selectedItems[category] = product;
            updateSelectionTable();
            updateWheelWithImage(category, product);
            closeModal();
            
            const instructions = document.getElementById('instructions');
            const selectionTable = document.getElementById('selectionTable');
            instructions.style.display = 'none';
            selectionTable.style.display = 'block';
        }

        function updateWheelWithImage(category, product) {
            const slices = document.querySelectorAll('.wheel-slice');
            slices.forEach(slice => {
                if (slice.dataset.category === category) {
                    slice.classList.add('selected');
                    addImageToSlice(slice, category, product);
                }
            });
        }

        function updateSelectionTable() {
            const container = document.getElementById('selectedItems');
            container.innerHTML = '';
            
            Object.entries(selectedItems).forEach(([category, item]) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'selected-item';
                itemDiv.innerHTML = `
                    <img src="${item.image_path}" alt="${item.name}" class="item-thumbnail">
                    <div class="item-details">
                        <div class="item-category">${category}</div>
                        <div class="item-name">${item.name}</div>
                        <div class="item-brand">${item.brand}</div>
                    </div>
                    <button class="remove-item" onclick="removeItem('${category}')">Ã—</button>
                `;
                container.appendChild(itemDiv);
            });
        }

        function removeItem(category) {
            delete selectedItems[category];
            updateSelectionTable();
            
            const slices = document.querySelectorAll('.wheel-slice');
            slices.forEach(slice => {
                if (slice.dataset.category === category) {
                    slice.classList.remove('selected');
                    const image = slice.querySelector('.slice-image');
                    if (image) image.remove();
                }
            });
            
            if (Object.keys(selectedItems).length === 0) {
                document.getElementById('instructions').style.display = 'block';
                document.getElementById('selectionTable').style.display = 'none';
            }
        }

        function closeModal() {
            document.getElementById('productModal').style.display = 'none';
        }

        function mixOutfit() {
            const button = document.getElementById('mixButton');
            const wheel = document.getElementById('wheelSvg');
            
            button.classList.add('spinning');
            wheel.style.animation = 'spin 2s ease-in-out';
            
            setTimeout(() => {
                button.classList.remove('spinning');
                wheel.style.animation = '';
                
                const emptyCategories = categories.filter(cat => !selectedItems[cat]);
                
                emptyCategories.forEach(category => {
                    const products = productCatalog[category] || [];
                    if (products.length > 0) {
                        const randomProduct = products[Math.floor(Math.random() * products.length)];
                        selectProduct(category, randomProduct);
                    }
                });
            }, 2000);
        }

        function showPreview() {
            const previewPanel = document.getElementById('previewPanel');
            const previewGrid = document.getElementById('previewGrid');
            
            previewGrid.innerHTML = '';
            
            Object.entries(selectedItems).forEach(([category, item]) => {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                previewItem.innerHTML = `
                    <img src="${item.image_path}" alt="${item.name}">
                    <div class="preview-item-label">${category}</div>
                `;
                previewGrid.appendChild(previewItem);
            });
            
            previewPanel.style.display = 'block';
        }

        function closePreview() {
            document.getElementById('previewPanel').style.display = 'none';
        }

        document.getElementById('searchBox').addEventListener('input', (e) => {
            if (currentCategory) {
                displayProducts(currentCategory, e.target.value);
            }
        });

        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('toggle-button')) {
                const group = e.target.parentElement;
                group.querySelectorAll('.toggle-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                e.target.classList.add('active');
            }
        });

        window.addEventListener('click', (e) => {
            const modal = document.getElementById('productModal');
            if (e.target === modal) {
                closeModal();
            }
        });

        loadProductCatalog();
    </script>
</body>
</html>